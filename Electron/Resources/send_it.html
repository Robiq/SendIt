<!doctype html>
<!-- 
*	TAKEN FROM: https://github.com/cjb/serverless-webrtc 
*	Bugfixes and small alterations made!
-->
<html>
<head>
    <meta charset="utf-8">
    <!-- TAKEN FROM https://stackoverflow.com/questions/32621988/electron-jquery-is-not-defined -->
    <!-- Insert this line above script imports  -->
	<script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>

	<!-- normal script imports etc  -->
		<script type="text/javascript" src="Scripts/base64binary.js"></script>
	    <script src="Scripts/jquery-3.2.1.js"></script>
	    <script src="Scripts/bootstrap.js"></script>

	<!-- Insert this line after script imports -->
	<script>if (window.module) module = window.module;</script>

    <!-- TITLE: 
    SEND IT - Serverless Secure Encrypted NodeJS-based Direct Information Transfer
    -->
    <title>SEND IT</title>
    <link rel="icon" href="favicon.png" />
    <script type="text/javascript" src="KeyManager.js"></script>
	<script type="text/javascript" src="FileManager.js"></script>
	<script type="text/javascript" src="myCrypto.js"></script>
	<script type="text/javascript" src="protocol.js"></script>
	<script type="text/javascript" src="settings.js"></script>
    <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->

    <style type="text/css">
		#drop_zone {
		  border: 2px dashed #bbb;
		  -moz-border-radius: 5px;
		  -webkit-border-radius: 5px;
		  border-radius: 5px;
		  padding: 25px;
		  text-align: center;
		  font: 20pt bold 'Vollkorn';
		  color: #bbb;
		}

		.ul {
			list-style-type: none;
			margin: 0;
			padding: 0;
			overflow: hidden;
			background-color: #333;
		}

		.li {
			float: left;
			border-right:1px solid #bbb;
		}

		.li:last-child {
			border-right: none;
		}

		.li a {
			display: block;
			color: white;
			text-align: center;
			padding: 14px 16px;
			text-decoration: none;
		}

		.li a:hover:not(.Active) {
			background-color: #111;
		}

		.Active {
			background-color: #4CAF50;
		}
	</style>
</head>
<body>

	<!-- Initial choice --> 
	<div class="modal" id="createOrJoin" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
		    <ul class="ul">
			  <li class="li"><a id="home" href="" class="Active">Home</a></li>
			  <li class="li"><a id="createBtn">Send</a></li>
			  <li class="li"><a id="joinBtn">Receive</a></li>
			  <li class="li"><a id="config">Configuration</a></li>
			</ul>
		</div>

	    <!-- 
		-->
					  	
		<div class="modal-body" id="showConfig" hidden>
		    <h5 id="txtMyMail">Your e-mail address:
	    		<input id="myMail" type="text" name="mailAddr">
	    	</h5>
			<form id="formInput">
	    		<h3>File options:</h3>
		    	<input type="radio" name="in" value="Automatic" checked> Automatic &emsp;
		    	<input type="radio" name="in" value="Manual"> Manual<br>
			</form>
			<div id="curSet" style="border-style: solid;"></div>

			<div id="opt" hidden>
		    	<!-- Horrible, but you have to manually select cryptoFile! -->
		    	<form id="formCrypt">
		    		<h3>Cryptofile options:</h3>
			    	<input type="radio" name="in" value="Automatic" checked> Automatic &emsp;
			    	<input type="radio" name="in" value="Manual"> Manual<br>
				</form>
		    	<h5 id="txtCryptoFile" value="Manual" hidden>Manually chose cryptofile:<br>
			    	<input type="File" id="cryptoFile" onchange="setCrypto()" accept=".crp">
		    	</h5>

		    	<form id="formDl">
		    		<h3>Download options:</h3>
			    	<input type="radio" name="in" value="Automatic" checked> Automatic &emsp;
			    	<input type="radio" name="in" value="Manual"> Manual<br>
				</form>
		    	<h5 id="setDlLoc" hidden>Download to:<br>
			    	<input type="File" id="downloadFolder" onchange="setDownload()" webkitdirectory directory>
		    	</h5>
		    	
		    	<form id="formUl">
		    		<h3>Upload options:</h3>
			    	<input type="radio" name="in" value="Automatic" checked> Automatic &emsp;
			    	<input type="radio" name="in" value="Manual"> Manual<br>
				</form>
		    	<h5 id="setUlLoc" hidden>Upload from:<br>
			    	<input type="File" id="uploadFolder" onchange="setUpload()"  value="" webkitdirectory directory>
		    	</h5>
		    </div>
	    	
	    	<button class="btn btn-primary" id="storeConfBtn" data-dismiss="modal" aria-hidden="true">Save</button>
		</div>
	</div>

	<!-- Show the offer created by this PC --> 
	<div class="modal" id="showLocalOffer" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" hidden>
	  <div class="modal-header">
	    <h3 id="myModalLabel">Share your offer</h3>
	  </div>
	  <div class="modal-body">
	    Here's your "offer" -- it tells someone else how to connect to you.  Send the whole thing to them, for example in an instant message or e-mail.
	  <br/>
	  <textarea class="input-large" id="localOffer" name="localOffer" rows="10" cols="100"></textarea>
	  </div>
	  <div>
	  	<div id="drop_zone">Drop files here</div>
		<output id="list"></output>
		<div style='color:red' id='error'></div>
	  </div>
	  <h5 id="txtRecMail">Receiver's e-mail address:
	    <input id="recMail" type="text" name="mailAddr">
	  <div class="modal-footer">
	    <button class="btn btn-primary" id="offerSentBtn" data-dismiss="modal" aria-hidden="true">Continue</button>
	  </div>
	  <div class="alert alert-success" id="success-alert">
		<strong style="color: red; font-size: x-large;">Contents copied!</strong>
	  </div>
	</div>

	<!-- Show the answer created by this PC --> 
	<div class="modal" id="showLocalAnswer" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" hidden>
	  <div class="modal-header">
	    <h3 id="myModalLabel">Share your answer with the sender</h3>
	  </div>
	  <div class="modal-body">
	    Here's your "answer" -- it tells someone else how to connect to you.  Send the whole thing to them, for example in an instant message or e-mail.
	  <br/>
	  <textarea class="input-large" id="localAnswer" name="localAnswer" rows="10" cols="100"></textarea>
	  </div>
	  <div class="modal-footer">
	    <button class="btn btn-primary" id="answerSentBtn" data-dismiss="modal" aria-hidden="true">Continue</button>
	  </div>
	  <div class="alert alert-success" id="success-alert">
		<strong style="color: red; font-size: x-large;">Contents copied!</strong>
	  </div>
	</div>

	<!-- Paste the offer created by other PC --> 
	<div class="modal" id="getRemoteOffer" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" hidden>
	  <div class="modal-header">
	    <h3 id="myModalLabel">Paste the "offer" you received</h3>
	  </div>
	  <div class="modal-body">
	    The person who created the room will send you an "offer" string -- paste it here.
	  <br/>
	  <textarea class="input-large" id="remoteOffer" name="remoteOffer" rows="10" cols="100"></textarea>
	  </div>
	  <div class="modal-footer">
	    <button class="btn btn-primary" id="offerRecdBtn" data-dismiss="modal" aria-hidden="true">Continue</button>
	  </div>
	</div>

	<!-- Show the answer created by the other PC --> 
	<div class="modal" id="getRemoteAnswer" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" hidden>
	  <div class="modal-header">
	    <h3 id="myModalLabel">Paste the "answer" you received</h3>
	  </div>
	  <div class="modal-body">
	    Now paste in the "answer" that was sent back to you.
	  <br/>
	  <textarea class="input-large" id="remoteAnswer" name="remoteAnswer" rows="10" cols="100"></textarea>
	  </div>
	  <div class="modal-footer">
	    <button class="btn btn-primary" id="answerRecdBtn" data-dismiss="modal" aria-hidden="true">Continue</button>
	  </div>
	</div>

	<!-- Wait for the other PC to connect --> 
	<div class="modal" id="waitForConnection" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" hidden>
	  <div class="modal-header">
	    <h3 id="myModalLabel">Waiting for connection</h3>
	  </div>
	  <div class="modal-body">
	    This dialog will disappear when a connection is made.
	  </div>
	</div>

	<!-- Connected screen -->
	<div class="modal" id="connectedScreen" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" hidden>
	  <div class="modal-header">
	    <h3 id="myModalLabel">Connected!</h3>
	  </div>
	  <div class="modal-body">
	    <button id="init" onclick="initiateSnd()">Start transfer</button>
	    <p id="Error" style="color:red"></p>
		<div id='transferDetails'></div>
	  </div>
	</div>

		<!-- End screen-->
	<div class="modal" id="endScreen" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" hidden>
	  <div class="modal-header">
	    <h3 id="myModalLabel">Connection terminated!</h3>
	  </div>
	  <div class="modal-body">
	    <!-- INSERT CODE HERE! -->
		<div id='transferDetailsEnd'></div>
	  	<div id="download">Files:<br></div>
	    <button class="btn btn-primary" id="openInFolder" data-dismiss="modal" aria-hidden="true" hidden>Open containing folder</button>	  		
	  </div>
	</div>

  	<script type="text/javascript" src="send_it.js"></script>
	<script type="text/javascript" src="readFile.js"></script>
</body>
</html>